{% extends "base.html" %}
{% block content %}

<div class="card">
    <h2>Add Student Marks</h2>

    {% if error %}
    <p style="color: red;">{{ error }}</p>
    {% endif %}

    <form method="post">
        {% csrf_token %}

        <label>Student:</label>
        <select name="student" id="studentSelect">
            {% for student in students %}
                <option value="{{ student.id }}">
                    {{ student.first_name }} {{ student.last_name }}
                </option>
            {% endfor %}
        </select>

        <label>Subject:</label>
        <select name="subject" id="subjectSelect"></select>

        <label>Marks Obtained:</label>
        <input type="number" name="marks">

        <label>Total Marks:</label>
        <input type="number" name="total">

        <label>Exam Type:</label>
        <input type="text" name="exam">

        <br><br>
        <button type="submit">Save Marks</button>
    </form>
</div>

{{ subject_map|json_script:"subjectMapData" }}
<script>
    const studentSelect = document.getElementById('studentSelect');
    const subjectSelect = document.getElementById('subjectSelect');
    const subjectMap = JSON.parse(document.getElementById('subjectMapData').textContent);

    function loadSubjects() {
        const selectedStudentId = studentSelect.value;
        const subjects = subjectMap[selectedStudentId] || [];
        subjectSelect.innerHTML = '';
        subjects.forEach((subjectName) => {
            const option = document.createElement('option');
            option.value = subjectName;
            option.textContent = subjectName;
            subjectSelect.appendChild(option);
        });
    }

    studentSelect.addEventListener('change', loadSubjects);
    loadSubjects();
</script>

{% endblock %}
